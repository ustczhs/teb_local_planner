# TEB Local Planner Configuration
# 重点优化：绕障后快速回归主线

# ==============================================================================
# 机器人配置（提升转向/速度恢复能力）
# ==============================================================================
robot:
  type: "differential_drive"
  # 适度提升前进速度上限（绕障后快速回归），保留角速度灵活性
  max_vel_x: 0.12          
  max_vel_x_backwards: 0.2  
  max_vel_y: 0.0          
  max_vel_theta: 0.9       # 进一步提升角速度，加快转向回归主线

  # 加速度限制：放宽纵向加速度，让速度快速恢复
  acc_lim_x: 1.2          
  acc_lim_y: 0.5          
  acc_lim_theta: 1.0      

  min_turning_radius: 0.2  
  wheelbase: 0.5          
  cmd_angle_instead_rotvel: false  

  footprint:
    type: "circle"        
    radius: 0.2          
    vertices: [[0.2,0], [0.1,0.1], [-0.1,0.1], [-0.1,-0.1], [0.1,-0.1]]

# ==============================================================================
# 轨迹规划配置（加快轨迹收敛）
# ==============================================================================
trajectory:
  dt_ref: 0.15            # 进一步减小时间分辨率，轨迹更精细且收敛更快
  dt_hysteresis: 0.03     # 降低滞后，快速响应主线轨迹

  min_samples: 5         
  max_samples: 150        # 减少最大采样点，避免轨迹过度分散

  # 触发轨迹重初始化的阈值：缩小距离/角度阈值，更快响应主线
  force_reinit_new_goal_dist: 0.8      
  force_reinit_new_goal_angular: 1.0  

# ==============================================================================
# 优化配置（提升回归主线权重）
# ==============================================================================
optimization:
  no_inner_iterations: 8   
  no_outer_iterations: 6   

  # 核心调整：提升路径跟踪权重，降低过度避障的优先级
  weight_max_vel_x: 1.5    # 提升速度权重，绕障后快速恢复速度
  weight_max_vel_theta: 1  
  weight_acc_lim_x: 1.0    # 恢复加速度权重，支持快速提速
  weight_acc_lim_theta: 1.0  
  weight_kinematics_nh: 1000  
  weight_obstacle: 120     # 适度降低障碍物权重（避免过度避障）
  weight_frenet_corridor: 40  # 大幅提升Frenet走廊权重，强制回归主线

# ==============================================================================
# 障碍物配置（避免过度远离主线）
# ==============================================================================
obstacles:
  min_obstacle_dist: 0.35     # 小幅降低最小障碍物距离（保证安全的前提下）
  inflation_dist: 0.6         # 缩小障碍物缓冲区，避免绕障过度偏离
  obstacle_poses_affected: 15 # 减少受影响位姿数，仅关注近距离障碍物
  obstacle_square_size: 2.5  

# ==============================================================================
# Frenet走廊约束（强制收敛到主线）
# ==============================================================================
frenet_corridor:
  enabled: true           
  corridor_width: 0.8     # 缩窄走廊，限制过度偏离
  min_corridor_width: 0.4  # 同步缩小最小走廊宽度

# ==============================================================================
# 传感器配置
# ==============================================================================
sensor:
  laser_topic: "/scan"           # 激光雷达话题
  fov_min_angle: -1.745          # FOV最小角度 (-100度)
  fov_max_angle: 1.745           # FOV最大角度 (+100度)
  obstacle_memory_time: 3.0      # FOV外障碍物记忆时间 (秒)
  cluster_distance_threshold: 0.1  # 聚类距离阈值 (m)
  cluster_min_points: 3          # 聚类最小点数
  downsample_factor: 2           # 降采样因子
  local_map_size: 4.0          # 局部地图大小 (m)

# ==============================================================================
# 测试场景配置
# ==============================================================================
simulation:
  dt: 0.1                
  robot_speed: 0.8       # 提升仿真速度，加快回归
  lookahead_distance: 4.0  # 适度减小前瞻（避免过度关注远端障碍物）

  obstacles:
    count: 5             
    amplitude: 5.0       
    frequency: 0.1       
    phase_offset: 1.57   

# ==============================================================================
# 可视化配置
# ==============================================================================
visualization:
  show_corridor_boundaries: true  
  show_obstacles: true           
  show_trajectory: true          
  scale_factor: 50.0             
