# TEB Local Planner Configuration
# 轻量级机器人局部规划模块配置参数

# ==============================================================================
# 机器人配置
# ==============================================================================
robot:
  # 机器人类型: differential_drive, ackermann, omnidirectional, legged
  type: "differential_drive"

  # 运动学参数
  max_vel_x: 0.8          # 最大前进速度 (m/s)
  max_vel_x_backwards: 0.3  # 最大后退速度 (m/s)
  max_vel_y: 0.0          # 最大侧向速度 (m/s) - 0表示非全向
  max_vel_theta: 0.5      # 最大角速度 (rad/s)

  # 加速度限制
  acc_lim_x: 0.5          # 最大线加速度 (m/s²)
  acc_lim_y: 0.5          # 最大侧向加速度 (m/s²)
  acc_lim_theta: 0.5      # 最大角加速度 (rad/s²)

  # 汽车机器人参数 (仅ackermann类型有效)
  min_turning_radius: 0.0  # 最小转向半径 (m) - 0表示差分驱动
  wheelbase: 0.5          # 轴距 (m)

  # 控制模式
  cmd_angle_instead_rotvel: false  # 是否使用角度控制代替角速度

  # Footprint配置
  footprint:
    type: "circle"        # circle 或 polygon
    radius: 0.2          # 圆形半径 (m)
    # 多边形顶点 (仅polygon类型有效) [[x1,y1], [x2,y2], ...]
    vertices: [[0.2,0], [0.1,0.1], [-0.1,0.1], [-0.1,-0.1], [0.1,-0.1]]

# ==============================================================================
# 轨迹规划配置
# ==============================================================================
trajectory:
  # 时间分辨率
  dt_ref: 0.3            # 期望时间分辨率 (s)
  dt_hysteresis: 0.1     # 自动调整滞后 (s)

  # 采样点数限制
  min_samples: 3         # 最小采样点数
  max_samples: 200       # 最大采样点数 (影响运算效率)

  # 热启动参数
  force_reinit_new_goal_dist: 1.0      # 强制重新初始化距离阈值 (m)
  force_reinit_new_goal_angular: 1.57  # 强制重新初始化角度阈值 (rad)

# ==============================================================================
# 优化配置 (影响运算效率和执行效果)
# ==============================================================================
optimization:
  # 迭代次数 (影响运算效率)
  no_inner_iterations: 5   # 内层迭代次数
  no_outer_iterations: 4   # 外层迭代次数

  # 约束权重 (影响执行效果)
  weight_max_vel_x: 2      # 最大线速度权重
  weight_max_vel_theta: 1  # 最大角速度权重
  weight_acc_lim_x: 1      # 线加速度权重
  weight_acc_lim_theta: 1  # 角加速度权重
  weight_kinematics_nh: 1000  # 非全向运动学权重
  weight_obstacle: 50      # 障碍物避让权重
  weight_frenet_corridor: 20  # Frenet走廊约束权重

# ==============================================================================
# 障碍物配置
# ==============================================================================
obstacles:
  min_obstacle_dist: 0.5      # 最小障碍物距离 (m)
  inflation_dist: 0.6         # 障碍物缓冲区距离 (m)
  obstacle_poses_affected: 15 # 受障碍物影响的位姿数 (影响运算效率)

# ==============================================================================
# Frenet走廊约束配置
# ==============================================================================
frenet_corridor:
  enabled: true           # 是否启用Frenet走廊约束
  corridor_width: 1.0    # 走廊宽度 (m)
  min_corridor_width: 0.5  # 最小走廊宽度 (m)

# ==============================================================================
# 传感器配置
# ==============================================================================
sensor:
  laser_topic: "/scan"           # 激光雷达话题
  fov_min_angle: -1.745          # FOV最小角度 (-100度)
  fov_max_angle: 1.745           # FOV最大角度 (+100度)
  obstacle_memory_time: 3.0      # FOV外障碍物记忆时间 (秒)
  cluster_distance_threshold: 0.1  # 聚类距离阈值 (m)
  cluster_min_points: 3          # 聚类最小点数
  downsample_factor: 2           # 降采样因子
  local_map_size: 4.0          # 局部地图大小 (m)

# ==============================================================================
# 测试场景配置
# ==============================================================================
simulation:
  dt: 0.1                # 仿真时间步长 (s)
  robot_speed: 0.9       # 机器人前进速度 (m/s)
  lookahead_distance: 4.0  # 规划前瞻距离 (m)

  # 动态障碍物配置
  obstacles:
    count: 2             # 障碍物数量
    amplitude: 0.6       # 运动振幅 (m)
    frequency: 0.5       # 运动频率 (Hz)
    phase_offset: 1.57   # 相位偏移 (rad)

# ==============================================================================
# 可视化配置
# ==============================================================================
visualization:
  show_corridor_boundaries: true  # 显示走廊边界
  show_obstacles: true           # 显示障碍物
  show_trajectory: true          # 显示规划轨迹
  scale_factor: 50.0             # 显示缩放因子 (pixel/m)
